<html>

<head>
    <style>
        canvas {
            margin: 20px;
            margin-bottom: 50px;
        }
    </style>
</head>

<body>
    <h1>Euro 2020 statistics</h1>
    <script src="node_modules/chart.js/dist/chart.min.js"></script>
    <script src="data.js"></script>
    <script>
        function createChart(title, labels, datas) {
            let canvas = document.createElement('canvas');
            canvas.width = "500";
            canvas.height = "500";

            let step = 360 / datas.length;
            let colorsHue = datas.map((elem, index) => `hsla(${index * step}, 100%, 50%, 0.2`);

            var ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: datas,
                        backgroundColor: colorsHue
                    }]
                },
                options: {
                    responsive: false,
                    plugins: {
                        title: {
                            display: true,
                            text: title
                        }
                    }
                }
            });
            return canvas;
        }

        function appendCanvas(title, labels, datas) {
            let chart = createChart(title, labels, datas);
            document.body.appendChild(chart);
        }

        appendCanvas(
            "Scorers",
            playerData.map(({ name }) => name),
            playerData.map(({ goals }) => goals)
        );

        // let countries = Array.from(new Set(playerData.map(({ country }) => country)));
        // appendCanvas(
        //     "Goals by country",
        //     countries,
        //     countries.map(c => playerData.reduce((acc, { country, goals }) => country == c ? goals + acc : acc, 0))
        // );

        let countries = playerData.reduce(
            (acc, { country, goals }) => {
                acc[country] = (acc[country] || 0) + goals;
                return acc;
            }, {});
        appendCanvas("Goals by country", Object.keys(countries), Object.values(countries));

        let clubs = playerData.reduce(
            (acc, { club, goals }) => {
                acc[club] = (acc[club] || 0) + goals;
                return acc;
            }, {}
        );
        appendCanvas("Goals by club", Object.keys(clubs), Object.values(clubs));

        let leagues = playerData.reduce(
            (acc, { league, goals }) => {
                acc[league] = (acc[league] || 0) + goals;
                return acc;
            }, {}
        );
        appendCanvas("Goals by league", Object.keys(leagues), Object.values(leagues));

        let ages = playerData.reduce(
            (acc, { age, goals }) => {
                let step = Math.floor(age / 5);
                let min = step * 5 + 1;
                let max = (step + 1) * 5;
                let key = `${min} - ${max}`;
                acc[key] = (acc[key] || 0) + goals;
                return acc;
            }, {}
        );
        ages = Object.entries(ages).sort();
        appendCanvas("Goals by age", ages.map(([k, v]) => k), ages.map(([k, v]) => v));
    </script>
</body>

</html>