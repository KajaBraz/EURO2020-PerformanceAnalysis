<!DOCTYPE html>
<html>

<head>
    <style>
        canvas {
            margin: 20px;
            margin-bottom: 50px;
        }

        h1 {
            text-align: center;
        }

        footer {
            text-align: right;
        }

        div.select_chart {
            text-align: center;
        }

        .pie_chart_class {
            margin-left: auto;
            margin-right: auto;
        }
    </style>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>UEFA Euro 2020 players statistics</title>
</head>

<body>
    <h1>UEFA Euro 2020 players statistics</h1>
    <div class="select_chart">
        <input type="radio" id="bar_radio" name="chart_type" value="bar" onchange="radio_function(this)" checked>
        <label for="bar_radio">Bar chart</label>
        <input type="radio" id="pie_radio" name="chart_type" value="pie" onchange="radio_function(this)">
        <label for="pie_radio">Pie chart</label>
    </div>
    <div id='container'></div>
    <footer>
        <p>Data source: <a href="https://en.wikipedia.org/wiki/UEFA_Euro_2020">Wikipedia</a></p>
        <p>Source code and contact: <a href="https://github.com/KajaBraz/FootballScorersAnalysis">Github</a></p>
    </footer>
    <script src="js/node_modules/chart.js/dist/chart.min.js"></script>
    <script src="js/data.js"></script>
    <script>
        function createChart(title, labels, datas, type) {
            let canvas = document.createElement('canvas');
            canvas.width = type == "bar" ? "1500" : "1500";
            canvas.height = type == "bar" ? "600" : "800";
            canvas.className = type == "bar" ? "" : "pie_chart_class";


            let step = 360 / datas.length;
            let colorsHue = datas.map((elem, index) => `hsla(${index * step}, 100%, 50%, 0.25`);

            var ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        data: datas,
                        backgroundColor: colorsHue
                    }]
                },
                options: {
                    responsive: type == "bar" ? true : false,
                    plugins: {
                        legend: {
                            display: type == "bar" ? false : true,
                            position: "left"
                        },
                        title: {
                            display: true,
                            text: title,
                            font: {
                                size: 20
                            }
                        }
                    }
                }
            });
            return canvas;
        }

        function appendCanvas(title, labels, datas, type) {
            let chart = createChart(title, labels, datas, type);
            document.getElementById('container').appendChild(chart);
        }

        function radio_function(radio) {
            document.getElementById("container").innerHTML = "";
            appendCanvas(
                "Scorers",
                playerData.map(({ name }) => name),
                playerData.map(({ goals }) => goals),
                radio.value
            );

            // let countries = Array.from(new Set(playerData.map(({ country }) => country)));
            // appendCanvas(
            //     "Goals by country",
            //     countries,
            //     countries.map(c => playerData.reduce((acc, { country, goals }) => country == c ? goals + acc : acc, 0))
            // );

            let countries = playerData.reduce(
                (acc, { country, goals }) => {
                    acc[country] = (acc[country] || 0) + goals;
                    return acc;
                }, {});
            appendCanvas("Goals by country (own goals excluded)", Object.keys(countries), Object.values(countries), radio.value);

            let clubs = playerData.reduce(
                (acc, { club, goals }) => {
                    acc[club] = (acc[club] || 0) + goals;
                    return acc;
                }, {}
            );
            appendCanvas("Goals by club", Object.keys(clubs), Object.values(clubs), radio.value);

            let leagues = playerData.reduce(
                (acc, { league, goals }) => {
                    acc[league] = (acc[league] || 0) + goals;
                    return acc;
                }, {}
            );
            appendCanvas("Goals by league", Object.keys(leagues), Object.values(leagues), radio.value);

            let ages = playerData.reduce(
                (acc, { age, goals }) => {
                    let step = Math.floor(age / 5);
                    let min = step * 5 + 1;
                    let max = (step + 1) * 5;
                    let key = `${min} - ${max}`;
                    acc[key] = (acc[key] || 0) + goals;
                    return acc;
                }, {}
            );
            ages = Object.entries(ages).sort();
            appendCanvas("Goals by age", ages.map(([k, v]) => k), ages.map(([k, v]) => v), radio.value);
        }

        window.onload = function () {
            let b = document.getElementById("bar_radio");
            let p = document.getElementById("pie_radio");
            b.checked = true;
            p.checked = false;
            radio_function(b);
        }

    </script>
</body>

</html>