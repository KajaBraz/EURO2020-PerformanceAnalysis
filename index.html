<!DOCTYPE html>
<html>

<head>
    <style>
        canvas {
            margin: 20px;
            margin-bottom: 50px;
            max-height: 750px;
        }

        h1 {
            text-align: center;
        }

        h3 {
            text-align: center;
        }

        footer {
            text-align: right;
            margin-right: 5%;
        }

        div.select_chart {
            text-align: center;
        }

        .pie_chart_class {
            margin-left: auto;
            margin-right: auto;
        }

        #container {
            width: 85%;
            margin: auto;
        }
    </style>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>UEFA Euro 2020 players statistics</title>
</head>

<body>
    <h1>UEFA Euro 2020 players statistics</h1>
    <h3 id="all_goals">All goals scored (excluded own goals): </h3>
    <div class="select_chart">
        <input type="radio" id="bar_radio" name="chart_type" value="bar" onchange="switch_to('bar')" checked>
        <label for="bar_radio">Bar chart</label>
        <input type="radio" id="pie_radio" name="chart_type" value="pie" onchange="switch_to('pie')">
        <label for="pie_radio">Pie chart</label>
        <p>
            <input type="checkbox" id="one_goal" onchange="modify_one_goal(this)">
            <label for="one_goal">Include one-goal-scorers</label>
        </p>
    </div>
    <div id='container'></div>
    <footer>
        <p>Data source: <a href="https://en.wikipedia.org/wiki/UEFA_Euro_2020">Wikipedia</a></p>
        <p>Source code and contact: <a href="https://github.com/KajaBraz/FootballScorersAnalysis">Github</a></p>
    </footer>
    <!-- it fixes drawing issue on safari version <14 on iphone -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=ResizeObserver"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.4.1/chart.min.js"></script>
    <script src="js/data.js"></script>
    <script>
        function switch_to(type) {
            Object.keys(all_charts).forEach(id => {
                all_charts[id].destroy();
                all_charts[id] = new Chart(
                    document.getElementById(id).getContext("2d"),
                    createChart(id, labels[id], datas[id], type)
                );
            });
        }

        function modify_one_goal(checkbox) {
            let title = "Scorers";
            all_charts[title].data.labels = checkbox.checked ?
                one_goal_labels : no_one_goal_labels;
            all_charts[title].data.datasets[0].data = checkbox.checked ?
                one_goal_datas : no_one_goal_datas;
            labels[title] = all_charts[title].data.labels;
            datas[title] = all_charts[title].data.datasets[0].data;
            all_charts[title].update();
        }

        function createChart(title, labels, datas, type) {
            let step = 360 / datas.length;
            let colorsHue = datas.map((elem, index) => `hsla(${index * step}, 100%, 50%, 0.25`);
            return {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        data: datas,
                        backgroundColor: colorsHue
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            display: type == "bar" ? false : true,
                            position: "bottom",
                            maxHeight: 200
                        },
                        title: {
                            display: true,
                            text: title,
                            font: {
                                size: 20
                            }
                        }
                    }
                }
            };
        }

        function appendCanvas(title, labels, datas, type = "bar") {
            let canvas = document.createElement('canvas');
            canvas.width = "1500";
            canvas.height = "600";
            canvas.id = title;
            document.getElementById('container').appendChild(canvas);
            let chart = new Chart(canvas, createChart(title, labels, datas, type));
            all_charts[title] = chart;
        }

        function fill_init(title, label_fill, data_fill) {
            labels[title] = label_fill;
            datas[title] = data_fill;
            appendCanvas(title, labels[title], datas[title]);
        }

        window.onload = function () {
            document.getElementById("bar_radio").checked = true;
            document.getElementById("pie_radio").checked = false;
            document.getElementById("one_goal").checked = false;
            document.getElementById("all_goals").innerHTML += all_goals;
        }

        let all_goals = playerData.reduce((acc, { goals }) => acc + goals, 0);
        let all_charts = {};
        let labels = {};
        let datas = {};

        let current_data = playerData.filter(({ goals }) => goals > 1);
        let no_one_goal_labels = current_data.map(({ name }) => name);
        let no_one_goal_datas = current_data.map(({ goals }) => goals);
        let one_goal_labels = playerData.map(({ name }) => name);
        let one_goal_datas = playerData.map(({ goals }) => goals);

        fill_init("Scorers", no_one_goal_labels, no_one_goal_datas);

        current_data = playerData.reduce(
            (acc, { country, goals }) => {
                acc[country] = (acc[country] || 0) + goals;
                return acc;
            }, {}
        );
        fill_init("Goals by country (own goals excluded)", Object.keys(current_data), Object.values(current_data));

        current_data = playerData.reduce(
            (acc, { club, goals }) => {
                acc[club] = (acc[club] || 0) + goals;
                return acc;
            }, {}
        );
        fill_init("Goals by club", Object.keys(current_data), Object.values(current_data));

        current_data = playerData.reduce(
            (acc, { league, goals }) => {
                acc[league] = (acc[league] || 0) + goals;
                return acc;
            }, {}
        );
        fill_init("Goals by league", Object.keys(current_data), Object.values(current_data));

        current_data = playerData.reduce(
            (acc, { age, goals }) => {
                let step = Math.floor(age / 5);
                let min = step * 5 + 1;
                let max = (step + 1) * 5;
                let key = `${min} - ${max}`;
                acc[key] = (acc[key] || 0) + goals;
                return acc;
            }, {}
        );
        current_data = Object.entries(current_data).sort();
        fill_init("Goals by age", current_data.map(([k, v]) => k), current_data.map(([k, v]) => v));

        current_data = playerData.reduce(
            (acc, { height, goals }) => {
                let step = Math.floor(height * 100 / 5);
                let min = step * 5 + 1;
                let max = (step + 1) * 5;
                let key = `${min} - ${max}`;
                acc[key] = (acc[key] || 0) + goals;
                return acc;
            }, {}
        );
        current_data = Object.entries(current_data).sort();
        fill_init("Goals by height (in cm)", current_data.map(([k, v]) => k), current_data.map(([k, v]) => v));
    </script>
</body>

</html>